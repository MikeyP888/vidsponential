<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Explorer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .status { font-weight: bold; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Database Explorer</h1>
        <p>Let's see what's actually in your scripts table...</p>
        
        <div class="section">
            <h3>Scripts Table Overview</h3>
            <button onclick="exploreScripts()">Explore Scripts Table</button>
            <div class="status" id="scriptsStatus">Ready to explore</div>
            <div id="scriptsResult"></div>
        </div>

        <div class="section">
            <h3>Status IDs Analysis</h3>
            <button onclick="analyzeStatusIds()">Analyze Status IDs</button>
            <div class="status" id="statusAnalysisStatus">Ready to analyze</div>
            <div id="statusAnalysisResult"></div>
        </div>

        <div class="section">
            <h3>Add Test Script</h3>
            <button onclick="addTestScript(15)">Add Script with Status 15</button>
            <button onclick="addTestScript(25)">Add Script with Status 25</button>
            <div class="status" id="addScriptStatus">Ready to add test data</div>
            <div id="addScriptResult"></div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://euzbpslzrimyokzvgbzk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV1emJwc2x6cmlteW9renZnYnprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1NDk5MTUsImV4cCI6MjA2NjEyNTkxNX0.HBznM8FVX0VnYBN8rTu6T-QOPmq0d60syavTCADl3JI';

        async function exploreScripts() {
            document.getElementById('scriptsStatus').textContent = 'Exploring...';
            const resultDiv = document.getElementById('scriptsResult');
            
            try {
                // Get all scripts with basic info
                const response = await fetch(`${SUPABASE_URL}/rest/v1/scripts?select=*&limit=20`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const scripts = await response.json();
                    
                    if (scripts.length === 0) {
                        resultDiv.innerHTML = `
                            <h4>No Scripts Found!</h4>
                            <p>Your scripts table is completely empty. You need to add some test data.</p>
                        `;
                        document.getElementById('scriptsStatus').textContent = 'Table is empty';
                    } else {
                        let html = `<h4>Found ${scripts.length} Scripts</h4>`;
                        html += `<table><tr><th>ID</th><th>Status ID</th><th>Headline</th><th>Client ID</th><th>Created</th></tr>`;
                        
                        scripts.forEach(script => {
                            html += `<tr>
                                <td>${script.script_id || 'NULL'}</td>
                                <td>${script.script_status_id || 'NULL'}</td>
                                <td>${script.script_headline || 'NULL'}</td>
                                <td>${script.client_id || 'NULL'}</td>
                                <td>${script.created_at || 'NULL'}</td>
                            </tr>`;
                        });
                        
                        html += `</table>`;
                        resultDiv.innerHTML = html;
                        document.getElementById('scriptsStatus').textContent = `Found ${scripts.length} scripts`;
                    }
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `<pre>Error: ${response.status}\n${errorText}</pre>`;
                    document.getElementById('scriptsStatus').textContent = 'Error occurred';
                }
            } catch (error) {
                resultDiv.innerHTML = `<pre>Error: ${error.message}</pre>`;
                document.getElementById('scriptsStatus').textContent = 'Error occurred';
            }
        }

        async function analyzeStatusIds() {
            document.getElementById('statusAnalysisStatus').textContent = 'Analyzing...';
            const resultDiv = document.getElementById('statusAnalysisResult');
            
            try {
                // Get count by status ID
                const response = await fetch(`${SUPABASE_URL}/rest/v1/scripts?select=script_status_id&limit=1000`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const scripts = await response.json();
                    
                    if (scripts.length === 0) {
                        resultDiv.innerHTML = `<p>No scripts to analyze - table is empty!</p>`;
                    } else {
                        // Count by status
                        const statusCounts = {};
                        scripts.forEach(script => {
                            const status = script.script_status_id || 'NULL';
                            statusCounts[status] = (statusCounts[status] || 0) + 1;
                        });

                        let html = `<h4>Status ID Distribution</h4>`;
                        html += `<table><tr><th>Status ID</th><th>Count</th><th>Description</th></tr>`;
                        
                        Object.entries(statusCounts).sort().forEach(([status, count]) => {
                            const description = getStatusDescription(status);
                            html += `<tr><td>${status}</td><td>${count}</td><td>${description}</td></tr>`;
                        });
                        
                        html += `</table>`;
                        
                        // Highlight what we need
                        html += `<h4>What Your App Needs:</h4>`;
                        html += `<ul>
                            <li><strong>Status 15</strong>: Scripts ready for outline editing (Found: ${statusCounts['15'] || 0})</li>
                            <li><strong>Status 25</strong>: Scripts ready for chapter editing (Found: ${statusCounts['25'] || 0})</li>
                        </ul>`;
                        
                        resultDiv.innerHTML = html;
                    }
                    
                    document.getElementById('statusAnalysisStatus').textContent = 'Analysis complete';
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `<pre>Error: ${response.status}\n${errorText}</pre>`;
                    document.getElementById('statusAnalysisStatus').textContent = 'Error occurred';
                }
            } catch (error) {
                resultDiv.innerHTML = `<pre>Error: ${error.message}</pre>`;
                document.getElementById('statusAnalysisStatus').textContent = 'Error occurred';
            }
        }

        async function addTestScript(statusId) {
            document.getElementById('addScriptStatus').textContent = `Adding test script with status ${statusId}...`;
            const resultDiv = document.getElementById('addScriptResult');
            
            try {
                const testScript = {
                    script_headline: `Test Script for Status ${statusId}`,
                    script_status_id: statusId,
                    primary_keyword: 'test keyword',
                    target_word_count: 1000,
                    created_at: new Date().toISOString()
                };

                const response = await fetch(`${SUPABASE_URL}/rest/v1/scripts`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(testScript)
                });

                if (response.ok) {
                    const result = await response.json();
                    resultDiv.innerHTML = `<h4>✅ Test Script Added Successfully!</h4><pre>${JSON.stringify(result, null, 2)}</pre>`;
                    document.getElementById('addScriptStatus').textContent = `Test script with status ${statusId} added successfully`;
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `<h4>❌ Failed to Add Script</h4><pre>Error: ${response.status}\n${errorText}</pre>`;
                    document.getElementById('addScriptStatus').textContent = 'Failed to add script';
                }
            } catch (error) {
                resultDiv.innerHTML = `<pre>Error: ${error.message}</pre>`;
                document.getElementById('addScriptStatus').textContent = 'Error occurred';
            }
        }

        function getStatusDescription(statusId) {
            const descriptions = {
                '15': 'Ready for Outline Editing',
                '20': 'Outline Completed',
                '25': 'Ready for Chapter Editing', 
                '30': 'Chapters Completed',
                '46': 'Ready for Visuals',
                'NULL': 'No Status Set'
            };
            return descriptions[statusId] || 'Unknown Status';
        }
    </script>
</body>
</html>